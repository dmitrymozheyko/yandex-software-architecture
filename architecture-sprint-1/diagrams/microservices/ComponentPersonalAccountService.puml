@startuml
title  WarmHouse™ Personal Account Web Application Component Diagram

top to bottom direction

!include ../c4_templates/C4_Component.puml

Container_Boundary(WarmHouseSystem, "WarmHouse™ System") {
  Container(PersonalAccountService, "Personal Account Backend Application", "Kotlin, Spring", "Provides REST API for frontend")
  ContainerDb(WarmHouseDatabase, "WarmHouse Database Database", "PostgreSQL", "Stores data")
  Container(RelayService, "Relay Service", "Reads data from relays")
  Container(TelemetryService, "Telemetry Service", "Fetch telemetry data")
  Container(AdministratorService, "Administrator Service", "Authentication/Authorization")
  ContainerQueue(Kafka, "Message Broker", "Kafka", "Process message queues")
}

Container(PersonalAccountService, "Contracts Web Application", "Kotlin, Spring") {
  Component(AuthController, "AuthController", "Handles authentication and authorization")
  Component(RegistrationController, "RegistrationController", "Manages user registration")
  Component(ContractController, "ContractController", "Manages user contracts")
  Component(RelayController, "RelayController", "Manages user devices")
  Component(TelemetryController, "TelemetryController", "Get metrics from user sensors")
  Component(ServiceLayer, "Service Layer ", "Business logic")
  Component(RepositoryLayer, "Repository Layer", "Data access logic")
}

Rel(AuthController,ServiceLayer,"Calls business logic")
Rel(ContractController,ServiceLayer,"Calls business logic")
Rel(RegistrationController,ServiceLayer,"Calls business logic")
Rel(RelayController,ServiceLayer,"Calls business logic")
Rel(TelemetryController,ServiceLayer,"Calls business logic")
Rel(ServiceLayer,RepositoryLayer,"Reads/Writes data")
Rel(RepositoryLayer,WarmHouseDatabase,"Reads/Writes user data")
Rel(ServiceLayer,RelayService,"Reads relays states")
Rel(ServiceLayer,RelayService,"Manage relays")
Rel(ServiceLayer,Kafka,"Sends commands to relays")
Rel(ServiceLayer,TelemetryService,"Reads data")
Rel(ServiceLayer,AdministratorService,"Authentication/Authorization")

@enduml
